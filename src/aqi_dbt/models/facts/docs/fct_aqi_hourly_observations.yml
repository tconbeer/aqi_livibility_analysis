version: 2

models:
  - name: fct_aqi_hourly_observations
    description: >
      This is basically "one big table" that includes every observation,
      and all of the relevant information from that observation's site
      dimension. In this model, we also convert raw measurements of
      pollutants to their AQI score, using a macro.

    tests:
      - dbt_utils.expression_is_true:
          expression: >
            observed_aqi >= 0
            and observed_aqi <= 500
          condition: observed_aqi is not null
            
    columns:
      - name: id
        tests:
          - unique
          - not_null
      - name: observed_at
      - name: observed_date
      - name: site_id
        tests:
          - not_null
      - name: site_name
        tests:
          - not_null
      - name: data_source_agency
        tests:
          - not_null
      - name: latitude
        tests:
          - not_null
      - name: longitude
        tests:
          - not_null
      - name: elevation
        tests:
          - not_null
      - name: epa_region
      - name: country_code
        tests:
          - not_null
      - name: msa_code
      - name: msa_name
      - name: state_code
      - name: state_name
      - name: county_code
      - name: county_name
      - name: parameter_name
        tests:
          - not_null
      - name: reporting_units
        tests:
          - not_null
      - name: observed_value
        tests:
          - not_null
          - nonnegative:
              where: parameter_name != 'TEMP'
      - name: observed_aqi
        tests:
          - not_null:
              where: >
                parameter_name in ('OZONE', 'PM10', 'PM2.5')